<!--
---- app/views/posts/index.html.erb
----
---- Called as:
----   /                     - display all posts by current user
----   /posts                - display list of all posts
----   /users/:user_id/posts - display list of all posts for user :user_id
-->

<div class="post-index">
  <div class="post-index-author">
    <% unless @all_posts %>
      <h1 class="post-index-author">Posts by <%= @user.name %></h1><hr>
    <% end %>
  </div>
  <% @posts.each do |p| %>
    <div class="post-index-item">
        <div class="post-index-item-image">
          <% if p.images.first %>
            <figure>
              <%=
                link_to (image_tag p.images.first.file.url,
                  class: 'post-index-item-image'), [@user, p]
              %>
            </figure>
          <% else %>
            &nbsp;
          <% end %>
        </div>

      <div class="post-index-item-body">
        <h1 class="post-index-item-body-title">
          <%= link_to p.title, [@user, p] %>
        </h1>
        <h2 class="post-index-item-body-title">
          <% if @all_posts %>
            <%= p.user.name %>
          <% end %>
          <%= p.created_at.localtime %>
          <% unless p.published %>
            <span class='unpublished-post'>(unpublished)</span>
          <% end %>
        </h2>
        <p class="post-index-item-body-text"><%= markdown p.body %></p>
      </div>
    </div>
    <br class="clear">
    <hr>
  <% end %>
  <div>
    <% if policy(@user.posts.build).create? # TODO hack %>
    <%= link_to 'New Post', new_user_post_path(@user) %> |
    <% end %>
    <%= link_to 'Back', :users %>
  </div>
</div>
